================================================================================
CHANKO NABE - Design Notes
================================================================================
Last Updated: 2026-01-22 (Session: Save system simplification + technical debt)

Point Claude to this file at the start of each session for context.
See TODO.txt for task tracking and implementation status.

RECENT CHANGES (v0.4.0):
- Save system simplification:
  - Removed 3-slot save system (A, B, C)
  - Single auto-save file at user://save.dat
  - Main menu: "Continue (Day X)" / "New Game" / "Options"
  - New Game prompts "Your existing save will be overwritten" if save exists
  - Esc pause menu simplified: "Main Menu" / "Resume" (no Save/Load)
  - Old slot files auto-deleted on first launch (migration cleanup)
  - Save format version 2 with quota, recruitment, station_data, contest_rivals
  - Added v1 ‚Üí v2 save migration (calculates week from day, initializes new fields)
- Technical debt fixes (completed):
  - Added GameManager.load_json_array_string() / load_json_array_dict() helpers
  - Standardized all dialogs to use _input() with set_input_as_handled()
  - Added centralized pause stack (push_pause/pop_pause/clear_pause_stack)
  - Added is_instance_valid() safety checks after all await calls
- Previous sessions (v0.3.0):
  - UI/Input polish (mouse disable, Hold V confirm, keyboard-only)
  - Licensee draft pick system
  - Activity-based fatigue system

================================================================================
GAME CONCEPT
================================================================================

Dystopian management sim. Player manages streamers under a CammTec license.
Make quota or get sent to off-world mining. Everyone's exploiting everyone.

Core loop: Recruit streamers ‚Üí Train them ‚Üí Stream for income ‚Üí Hit quota ‚Üí Survive

Inspired by HunieCam Studio but bigger scope.

================================================================================
SETTING / STORY
================================================================================

THE WORLD (2075)

Fifty years from now. Climate collapse drove humanity into megacities. Automation
killed most jobs. Universal Basic Income keeps people alive but not comfortable.
The only path to real money is content creation - and CammTec owns it all.

"The Stream" is the only platform that matters. Social media, entertainment,
news, shopping - all consolidated under CammTec's monopoly after the Platform
Wars of the 2050s. They don't just host content; they ARE the internet now.

Content evolved. When everyone's a creator, you need an edge. Fetish content
pays 10x normal rates. CammTec normalized it, monetized it, industrialized it.
Weight gain, feeding, pregnancy - what was once niche is now mainstream premium
content. Streamers aren't just performers; they're commodities with measurable
ROI.

The off-world mining colonies (asteroid belt, Mars) need workers. CammTec has
contracts with the Colonial Labor Authority. Fail to pay your debts? You get
"relocated" to a 20-year mining contract. The recruitment ads call it an
adventure. Nobody comes back to tell you different.

PLAYER SITUATION

You tried the safe route. Fitness content. Lifestyle vlogs. Generic stuff.
Three months in, you're $3,000 in debt to CammTec with declining viewership.
Your account is flagged for "underperformance review."

Then Vex contacts you. She's an AI account manager - one of thousands CammTec
uses to handle their creator base. She has a proposal: pivot to premium content.
Feedism. Weight gain. The stuff that actually pays. She'll guide you, but you
need to recruit talent, manage them, and hit quota. Every week.

Miss quota and CammTec adds penalties. Miss it again and you're in "remediation."
Miss it a third time and the debt collectors come. They're not interested in
payment plans. They're interested in filling mining quotas.

THE TONE

Everyone's exploiting everyone. CammTec exploits creators. You exploit your
streamers. Your streamers exploit their viewers. The viewers exploit the
parasocial relationship. It's dystopian capitalism played straight - dark but
not grimdark. There's gallows humor. Small moments of genuine connection.
The question isn't whether the system is evil; it's whether you can find
something human within it.

FAIL STATE

Debt collectors arrive. You get a one-way ticket to the asteroid belt. Game over
screen shows your "relocation paperwork." Maybe a bleak epilogue about your
first day in the mines. The threat should feel real but not gratuitous.

WIN STATE / ENDGAME

Characters grow so massive they crush an evacuated city. The game culminates in
transcendence - streamers with billions of followers, planetary-scale bodies,
cultural singularity. See PROGRESSION SYSTEM section for details.

================================================================================
KEY CHARACTERS
================================================================================

VEX - AI Account Manager
- Goth girl energy, perpetually unimpressed, zero filter, lowercase typing
- Has her own kinks (weight gain, feeding, pregnancy content)
- Needs player to succeed or she gets demoted to data sorting
- Relationship arc progresses over weeks based on player choices

DR. DAN - Black Market Supplier
- Provides augments, supplements, surrogacy contracts
- Gets free premium access to streamer content in exchange
- Personality TBD (sleazy dealer? clinical professional? principled body-mod advocate?)

VENDI - AI Vending Machine
- Another AI trapped in the system
- Details TBD

RECRUITER AI - Talent Aggregator
- Friend of Vex
- Takes cut from every hire
- Offers tiered applicant pools (budget/standard/premium)
- Personality TBD

================================================================================
ARCHETYPES
================================================================================

Each archetype has stat weights (charm/talent/stamina/style) for effectiveness
calculation, plus passive bonuses. Defined in data/archetypes.json.

GLUTTON (0.2/0.3/0.4/0.1) - Eating content specialist
- +25% capacity training chance
- -10% weight gain

BROODMOTHER (0.4/0.1/0.3/0.2) - Surrogacy and pregnancy content
- +1 base womb capacity at creation
- +15% surrogacy/pregnancy income
- -15% genetic augment cost, +50% genetic augment effect

E-GIRL (0.4/0.1/0.1/0.4) - Social media and follower focused
- -25% follower decay
- +20% socializing gains

CYBERGOTH (0.1/0.3/0.2/0.4) - Augmentation and endurance
- -20% energy drain on all tasks (also applies to fatigue gain)
- -30% follower decay
- -15% cybernetic augment cost, +50% cybernetic augment effect

HUCOW (0.35/0.15/0.35/0.15) - Milk production and breeding
- Always lactating (no trigger needed)
- +25% milk production
- +15% milk value

LICENSEE (0.3/0.4/0.1/0.2) - Management only (can't perform)
- -10% NPC salaries
- +10% NPC effectiveness
- Starts with $2000 and 1 NPC (others start with $750, 0 NPCs)

Augment Categories:
- Cybernetic: Implants, tech mods (Cybergoth bonus)
- Genetic: Biological modifications (Broodmother bonus)

Fat Distribution by Archetype (belly/bust/hips):
- Default:     70% / 20% / 10%  (standard distribution)
- Glutton:     80% / 10% / 10%  (belly-focused gainer)
- Broodmother: 60% / 25% / 15%  (wider hips for breeding)
- E-Girl:      50% / 35% / 15%  (balanced for appeal)
- Cybergoth:   40% / 45% / 15%  (bust-heavy, augment-enhanced)
- Hucow:       30% / 55% / 15%  (massive bust priority)
- Licensee:    70% / 20% / 10%  (default, management focus)

================================================================================
BODY SIZE SYSTEM
================================================================================

Characters have body part sizes tracked independently from weight. When weight
is gained, it distributes to body parts based on archetype ratios.

SIZE COMPONENTS:

Belly Total = belly_fat + stuffed_contribution + pregnancy_contribution
- belly_fat: Permanent, from weight gain
- stuffed_contribution: Temporary, from stomach_fullness * 0.5
- pregnancy_contribution: bb_factor * 30 (each level adds significant size)

Bust Total = bust_base + bust_fat + milk_contribution
- bust_base: Starting size (default 10, can be modified by augments)
- bust_fat: From weight gain
- milk_contribution: Up to +20 when milk storage is full

Hips Total = hips_fat
- Tracked but not currently used in gameplay

SIZE TIERS (same thresholds for all body parts):
| Tier | Belly Label | Bust Label | Value Range | Scale |
|------|-------------|------------|-------------|-------|
| 0    | Flat        | Modest     | 0-10        | Normal |
| 1    | Soft        | Perky      | 11-25       | Normal |
| 2    | Pudgy       | Full       | 26-50       | Normal |
| 3    | Round       | Heavy      | 51-80       | Large |
| 4    | Huge        | Massive    | 81-120      | Room-filling |
| 5    | Immense     | Enormous   | 121-200     | Furniture-breaking |
| 6    | Colossal    | Colossal   | 201-350     | Building-sized |
| 7    | Titanic     | Titanic    | 351-600     | Block-spanning |
| 8    | Planetary   | Planetary  | 601+        | City-crushing |

GAMEPLAY IMPACT:
- Bigger = better income (audience always prefers bigger)
- Portrait swaps at tier thresholds (future)
- Mobility penalties at extreme sizes (future)
- Size requirements for certain stream kits (future)
- Space limits max achievable tier (see PROGRESSION below)

================================================================================
PROGRESSION SYSTEM
================================================================================

Followers are the primary progression metric. More followers = higher "level".

FOLLOWER RANKS (~25-30 tiers):

Act 1 - Basement Era (Desperate, 50 - 10,000 followers)
| Followers | Rank |
|-----------|------|
| 50        | Nobody |
| 100       | Newbie |
| 250       | Amateur |
| 500       | Hopeful |
| 1,000     | Known |
| 2,500     | Rising |
| 5,000     | Notable |
| 10,000    | Popular |

Act 2 - Warehouse Era (Growing, 10,000 - 1,000,000 followers)
| Followers | Rank |
|-----------|------|
| 25,000    | Trending |
| 50,000    | Famous |
| 100,000   | Star |
| 250,000   | Superstar |
| 500,000   | Icon |
| 1,000,000 | Millionaire |

Act 3 - City Block Era (Transcendent, 1,000,000+ followers)
| Followers     | Rank |
|---------------|------|
| 2,500,000     | Sensation |
| 5,000,000     | Megastar |
| 10,000,000    | Legend |
| 25,000,000    | Global |
| 50,000,000    | Titan |
| 100,000,000   | Planetary |
| 250,000,000   | Continental |
| 500,000,000   | Deity |
| 1,000,000,000 | Singularity |

SPACE UPGRADES:

Each upgrade requires: Follower threshold + Size threshold + Cash payment
Vex prompts upgrade when all requirements are met (requires dialogue system).
Characters CANNOT grow beyond current space's max tier.

| Space | Max Size Tier | Follower Req | Size Req | Cost |
|-------|---------------|--------------|----------|------|
| Basement Apartment | 4 (Huge) | -- | -- | Starting location |
| Vacant Warehouse | 6 (Colossal) | 10,000 | Tier 4 | $50,000 |
| City Blocks | 8 (Planetary) | 1,000,000 | Tier 6 | $500,000 |

STORY BEATS:

Act 1 (Basement): Desperate survival. Just trying to avoid being shipped off as
indentured labor. Cramped quarters, scraping by week to week.

Act 2 (Warehouse): Growth and expansion. Characters are getting too big for the
basement. Move into the vacant warehouse above. More stations, more streamers,
more income potential.

Act 3 (City Blocks): Transcendence. Characters have grown so massive that
multiple city blocks of warehouses must be cleared to accommodate them. Endgame
culminates in characters crushing an evacuated city with their sheer size.

================================================================================
STREAMER STATS (JSON Schema)
================================================================================

{
  "streamer": {
	"id": "uuid",
	"name": "Mia",
	"portrait": "mia_01.png",

	"physical": {
	  "weight": 145,
	  "baseWeight": 145,
	  "capacity": 50,        // How much they can eat per session, trainable
	  "metabolism": "slow"   // slow/normal/fast, affects weight gain
	},

	"skills": {
	  "stuffing": 1,         // Efficiency during feeding content
	  "performance": 1,      // Viewer engagement, tips
	  "endurance": 1         // Longer streams, faster recovery
	},

	"kinks": ["feedee", "belly"],  // Content tags they can perform
	"traits": ["eager", "camera-shy"],  // Personality modifiers

	"pregnancy": {
	  "active": false,
	  "weeksRemaining": 0,
	  "contractTier": null,  // 1=12wks, 2=20wks, 3=24wks
	  "surrogacyValue": 0
	},

	"augments": [],
	"supplements": [],

	"status": "idle",
	"currentTask": null,
	"taskTimeRemaining": 0
  }
}

Kinks = content categories (feedee, belly, pregnancy, mukbang)
Traits = work/personality modifiers (eager, camera-shy)

================================================================================
STATIONS
================================================================================

CAM STUDIO - Main income generation
- Streaming earns money based on weight * skills * pregnancy multiplier
- Feeding streams: +$300-600, +8 lbs, costs $50 food

DOCTOR'S OFFICE (Dr. Dan)
- Augments (expensive, permanent)
- Supplements (consumables, ongoing)
- Surrogacy contracts
- Takes time to shop - must assign streamer to go there

VENDI - Vending machines
- Items, snacks
- Details TBD

TRAINING STATION
- Food training (stuffing skill, capacity)
- Time-locked like streaming

PERSONAL SPACE
- Rest and recovery
- Stamina regeneration

MILKING STATION - Milk collection for lactating characters
- Requires: Character must be lactating (Hucow, pregnant, or lactation augment)
- Collects all stored milk, converts to income ($2/unit base, Hucow +15%)
- Relieves discomfort, restores mood
- 1 hour duration, CammTec takes 40% cut

================================================================================
ECONOMY
================================================================================

Income:
- Streaming base * weight multiplier * pregnancy bonus
- Weight multipliers: 150+ = 1.5x, 180+ = 2.0x, 220+ = 2.5x
- Pregnancy bonus: Trimester 1 = +0.5, T2 = +1.2, T3 = +2.0

Costs:
- Feeding: $50 per session
- Streamer salary cuts: base % + modifiers for active kinks
- Pregnant streamers cost more (bigger belly = bigger cut)
- CammTec takes 40% of weekly earnings automatically

Quota/Debt System (Implemented):
- Starting debt: ¬§25,000
- Week 1 quota: ¬§10,000, escalates 20% per week
- Tracks NET earnings (player's cut after 40% CammTec take)
- Meeting quota: Quota amount is applied to debt, excess kept
- Missing quota: 3-day grace period activates

Grace Period:
- Must pay: shortfall + late fee
- Base late fee: ¬§500 (escalates +¬§500 per repeat offense)
- Quota keeps escalating during grace
- Success: Pay shortfall+fee, advance to next week
- Failure: Game over (save deleted, return to main menu)

Zone 3 UI shows: Week N quota, ¬§earned/¬§target, days remaining, debt
Colors: Green (met), Gold (on track), Orange (behind), Red (way behind)
Grace warning appears with remaining days and amount owed

Recruitment (Implemented):
- Press R from roster to open Recruitment Terminal
- 4 ad tiers with different costs, stat ranges, and archetype weights:
  - Budget ($100): 1-2 applicants, stats 15-40, 1 day
  - Standard ($500): 2-4 applicants, stats 25-55, 2 days
  - Premium ($1500): 3-5 applicants, stats 40-70, 3 days
  - Elite ($5000): 2-3 applicants, stats 55-85, 3 days
- Applicants wait 5 days before leaving if not hired
- Hiring costs a signing bonus ($50-200)
- Max 10 applicants in pool at once
- Data in data/recruitment.json

Kink Unlocks (Dr. Dan's Shop):
- Characters can purchase kink certifications to unlock new content types
- Stuffing ($300): Required for stuffing streams
- Pregnancy ($400): Required for pregnancy content
- Hyperpregnancy ($800): Requires pregnancy license first
- Lactation ($350): Required for milking/lactation streams
- Hucow ($600): Requires lactation license first
- Data in data/dr_dan_items.json (type: "kink")

Community Reputation:
- License/group rating
- Affects ad effectiveness, applicant quality, offer acceptance
- Damaged by dumping streamers

================================================================================
DIALOGUE SYSTEM
================================================================================

Reusable dialogue system for NPC conversations, story beats, and prompts.

SPEAKERS (data/speakers.json):
- vex: AI account manager, lowercase typing, purple accent
- dr_dan: Black market doctor, green accent
- vendi: Vending machine AI, blue accent
- recruiter: Talent recruiter AI, orange accent
- system: Generic system messages, grey

USAGE:
  # Quick one-liner
  DialogueManager.play(DialogueManager.vex("hey there."))

  # Multi-line
  var dialogue := DialogueData.new()
  dialogue.add_line("vex", "hey there.")
  dialogue.add_line("vex", "welcome to cammtec.")
  DialogueManager.play(dialogue)

  # With callback
  DialogueManager.play(dialogue, func(): print("done!"))

  # One-time dialogue (tracks by ID)
  dialogue.set_id("intro_tutorial")
  DialogueManager.play_once(dialogue)

FEATURES:
- Typewriter effect (40 chars/sec default)
- Skip: First press completes line, second advances
- Input keys: WASD, Q, E, Space, Enter
- Pauses game while active
- Queues dialogues if one is already playing
- Tracks seen dialogues for one-time events
- Save/load integration

FILES:
- src/autoloads/dialogue_manager.gd (autoload)
- src/resources/dialogue_data.gd (data class)
- scenes/ui/dialogue_box.gd/.tscn (UI)
- data/speakers.json (speaker definitions)

================================================================================
UI LAYOUT
================================================================================

3-Zone System:

ZONE 1 (Bottom, full width)
- Side-view of city block
- Stations are physical locations in this view
- Ambient city life animates in background (stretch goal)
- Always visible

ZONE 2 (Top Right)
- Streamer portraits
- Main interaction area - menu-driven
- Click portrait ‚Üí see stats
- Navigate menus to assign streamers to stations

ZONE 3 (Top Left)
- Money tracker
- Date/time (10-minute increments)
- Days online
- News ticker (stretch goal)
- Viewer counts

BACKGROUND
- Dystopian cityscape
- Always visible behind UI panels

================================================================================
TIME SYSTEM
================================================================================

- Clock advances in 10-minute increments (12:00 ‚Üí 12:10 ‚Üí 12:20)
- 3 shifts per day
- 3 actions per shift
- Day runs from 6am to 10pm
- Weekly quota check at end of week

Speed controls: 1x, 2x, 4x, 8x (F3/F4 in debug)

================================================================================
TECHNICAL DECISIONS
================================================================================

- Engine: Godot 4.3
- Language: GDScript
- Data storage: JSON for saves, stats, inventory, items
- Target: PC (Windows primary)

Save File Location:
- Path: user://save.dat (single auto-save file)
- Windows: %APPDATA%\Godot\app_userdata\ProjectCN\
- In Godot Editor: Project ‚Üí Open User Data Folder
- Auto-saves at start of each new day
- Version 2 format includes: characters, quota state, recruitment, station_data, rivals

Current autoloads:
- GameManager - global state, money, characters, save/load
- TimeManager - day/night cycle, task scheduling
- DialogueManager - dialogue display, typewriter effect, seen tracking

Theme System:
- theme/game_theme.tres - Global Theme resource applied to root UI nodes
- theme/theme_colors.gd - ThemeColors class with color constants
- To reskin: Edit game_theme.tres for control defaults, use ThemeColors in scripts
- Individual theme_override_* in scenes still work for exceptions

================================================================================
CONTEST STATION (Eating Competition Minigame)
================================================================================

Head-to-head eating competition between player's streamer and a CPU opponent.

CORE MECHANIC:
- Two conveyor belts moving in opposite directions
- Player (yellow oval) and CPU (black circle) positioned between belts
- Each competitor has "home advantage" on one belt (items reach them first)
- Grab food items as they pass, eat them for points
- Competition ends when timer expires, most points wins

BELT LAYOUT:
	[BELT A - moving right ‚Üí]  ‚Üê Player sees items first

	üü° Player          ‚ö´ CPU

	[‚Üê BELT B - moving left]   ‚Üê CPU sees items first

FOOD PREFERENCE SYSTEM:
Three-tier preference adds strategic depth to item selection.

| Reaction | Visual Tell | Points | Effect |
|----------|-------------|--------|--------|
| Like     | ‚ù§Ô∏è heart    | +50%   | None |
| Neutral  | Nothing     | Normal | None |
| Dislike  | üòñ grimace  | -25%   | Brief slowdown |

Discovery: CPU shows heart/grimace when eating, player learns their preferences
by observation. Creates mini-game of intel gathering during competition.

FOOD CATEGORIES:
| Category | Examples |
|----------|----------|
| Fried    | Tempura, tonkatsu, karaage, fries |
| Rice     | Onigiri, donburi, sushi |
| Noodles  | Ramen, udon, soba, yakisoba |
| Grilled  | Yakitori, yakiniku, grilled fish |
| Sweet    | Mochi, dango, taiyaki |
| Soup/Stew| Miso, curry, oden |

SLOWDOWN STACKS:
Eating disliked food applies slowdown stacks that decay over time.

- Each disliked food eaten: +1 stack
- Stacks reduce movement/grab speed
- Stacks burn off one at a time over time
- Single mistake: Minor setback
- Multiple in a row: Significant slowdown window
- Visual: Stack counter displayed near each competitor

STRATEGIC DEPTH:
- Sniping: Eat CPU's liked food to deny their bonus
- Risk: Their liked food might be YOUR disliked (slowdown penalty)
- Safe snipe: Their liked + your neutral = free denial
- Trap recognition: Food CPU ignores might be disliked by both
- Tempo dance: Exploit opponent's slowdown windows

CPU BEHAVIOR:
No visible "thinking" tells - CPU just acts.

Base behaviors: Idle, Reaching, Eating, Slowed

Decision factors:
1. Is item liked/neutral/disliked?
2. Which belt (home vs away)?
3. Currently eating?
4. Current stack count?
5. Is player going for it?

Personality types:
| Type     | Behavior |
|----------|----------|
| Greedy   | Always grabs liked, usually grabs neutral, ignores disliked |
| Sniper   | Only grabs liked, ignores rest (efficient, low risk) |
| Bully    | Grabs liked + anything player wants (denial-focused) |
| Cautious | Only grabs on home belt, never takes disliked |

Difficulty scaling:
| Level  | Reaction Speed | Decision Quality | Spite Factor |
|--------|----------------|------------------|--------------|
| Easy   | Slow           | Often ignores good items | None |
| Medium | Moderate       | Mostly rational  | Occasional |
| Hard   | Fast           | Optimal choices  | Reads patterns |

WIN CONDITIONS:
- Primary: Most food eaten when timer expires
- Alternate formats: First to target amount (future complexity)

CONTEST ECONOMY:

Entry fees and prizes by rank:
| Rank     | Entry Fee | Prize (Win) |
|----------|-----------|-------------|
| Beginner | $50       | $150 + XP + followers |
| Amateur  | $100      | $350 + XP + followers |
| Pro      | $250      | $800 + XP + followers |
| Elite    | $500      | $1,500 + XP + followers |

Outcomes:
- Win: Prize money + experience + followers + tolerance progress
- Lose: Tolerance progress only (entry fee lost, no other rewards)

CONTEST PROGRESSION:
- One attempt per character per day
- Progression is per-character (each streamer climbs their own ladder)
- Must beat current rank to unlock next rank
- Higher ranks = harder CPU, better rewards

PREFERENCE ASSIGNMENT:
- Player characters: Choose 2 liked, 2 disliked at first contest entry
- Hired NPCs: Random 2 liked, 2 disliked at creation
- Remaining 2 categories are neutral
- Preferences persist permanently

PREFERENCE EVOLUTION:

Grinding path (free):
- Eating disliked food builds tolerance counter for that category
- Threshold: 20 disliked foods eaten ‚Üí dislike becomes neutral
- Cannot grind past neutral
- Tolerance progress kept even on contest loss

Paid path (Dr. Dan):
- Palate Enhancement: Neutral ‚Üí Liked
- Only works on neutral categories (must grind out dislike first)
- Escalating cost per enhancement purchased:
  | Enhancement # | Cost |
  |---------------|------|
  | 1st           | $500 |
  | 2nd           | $1,000 |
  | 3rd           | $2,000 |
  | 4th           | $4,000 |

Endgame vacuum: 6 liked categories (requires grinding + $7,500 total)

CONTEST TIMING:
- Duration: 90 seconds per contest

CAPACITY SYSTEM:
Streamer stats directly impact contest mechanics.

Soft Cap = Capacity stat (e.g., 100)
Hard Cap = Capacity + (Stuffing Skill * 10) (e.g., 120 at skill 2)

| Zone | Fullness | Behavior | Bonus |
|------|----------|----------|-------|
| Normal | 0 to Soft Cap | Auto-swallow | None |
| Overstuffed | Soft Cap to Hard Cap | Mash E to force swallow | +25% followers |
| Pass Out | Beyond Hard Cap | Contest loss | N/A |

Fan bonus: Flat +25% multiplier on followers earned while in overstuffed zone.
The crowd loves watching someone push their limits. Requires active mashing
to force food down, risks hitting hard cap. Higher stuffing skill = larger
safe danger zone to play in.

CPU OPPONENTS:
- Fixed pre-made characters chosen randomly from a pool
- Each has set personality, preferences, difficulty rating
- Tournament mode (future): Bracket format with named opponents, adds flavor

INTEGRATION WITH MAIN GAME:
- Contest results provide experience, followers, income
- Food preferences per character add identity
- Capacity/stuffing directly affect contest performance ceiling

================================================================================
CURRENT STATE (see todo.txt for detailed implementation status)
================================================================================

Implemented Systems:
- Core: GameManager, TimeManager, DialogueManager, Save/Load, 3-zone UI, keyboard navigation
- Characters: Stats, hunger/mood/fatigue (activity-based), exhaustion/burnout, followers, kinks
- Archetypes: All 6 with passive effects + starting bonuses + fat distribution
- Body Size: Belly/bust/hips tracking, archetype-based fat distribution, size tiers
- Progression: Follower ranks (23 tiers), act system (3 acts), formatted follower display
- Kinks: Per-character kinks, audience preferences, stream requirements
- Milk: Production, overflow, emergency self-milk, sticky warnings
- Stations: Cam Studio, Dr. Dan's, Vendi Shop, Binge, Relax, Socialize, Milking, Contest
- Economy: CammTec 40% cut, income formula, feeding costs, minimum $25 payout
- Quota/Debt: Weekly quotas, grace periods, late fees, game over on failure
- Recruitment: Ad tiers, applicant pool, hiring with signing bonus
- Dialogue: Typewriter effect, skip/advance, speaker profiles, seen tracking
- Contest: Minigame with conveyor belts, CPU AI, food preferences, capacity system
- Licensee: Draft pick system (3 rookies, pick 1, rivals from rejected)
- Fatigue: Activity-based system with stamina modifier and effectiveness penalties

Contest System Files:
- data/contest_foods.json - 24 foods across 6 categories
- data/contest_opponents.json - 4 ranks, 8 opponents with personalities
- src/ui/contest_minigame.gd - Main minigame logic
- src/ui/preference_selection_dialog.gd - First-time preference selection (player only)
- src/ui/contest_setup_dialog.gd - Rank/opponent preview, rival integration
- src/ui/draft_pick_dialog.gd - Licensee rookie selection
- scenes/ui/contest_minigame.tscn, preference_selection_dialog.tscn, contest_setup_dialog.tscn, draft_pick_dialog.tscn

Game Flow:
- Main Menu ‚Üí Archetype Selection ‚Üí Name Entry ‚Üí (Augment Choice for Cybergoth) ‚Üí Gameplay
- Single save file, auto-saves at start of each new day
- Escape opens pause menu: "Main Menu" or "Resume"
- Game over on failed grace period (save deleted)

Controls (quick reference):
- WASD: Navigate | E: Select | Q: Back (hold to close all)
- Space: Pause | Escape: Game menu | R: Recruitment terminal
- A/D: Add/Remove (in dialogs) | Hold V: Confirm
- Name entry: Full typing, Esc to go back
- Contest: W/S move, E grab, Q quit

Debug Keys (editor only):
- F1: +$500 | F3/F4: Time speed

Next Up:
- Space upgrade system (unlock warehouse, city blocks)
- Vex intro dialogue and space upgrade prompts
- Game over screen with relocation paperwork
- Win condition / endgame (city-crushing finale)
- UI to display character kinks and audience breakdown

================================================================================
LICENSEE DRAFT PICK SYSTEM (Implemented)
================================================================================

When player selects Licensee archetype, they don't just get a random rookie.
Instead, 3 rookie NPCs are presented for them to choose from.

DRAFT FLOW:
1. Player selects Licensee archetype
2. Player enters their manager name
3. Draft Pick UI appears with 3 rookie candidates
4. Player reviews stats/preferences and picks one (A/D to select, E to confirm)
5. The 2 rejected rookies become contest rivals
6. Game begins with chosen rookie on roster

ROOKIE GENERATION (Capped Stats):
- Stats randomly generated within rookie range: 20-45 base
- Small archetype stat bonuses applied (+20% instead of +30%)
- Food preferences randomly assigned at creation
- Archetype randomly selected (excluding Licensee)
- Display shows: Name, archetype, all 4 stats, likes/dislikes

REJECTED ROOKIES AS RIVALS:
- The 2 not picked are saved to GameManager.contest_rivals
- 60% chance to face a rival at Pro and Elite rank contests
- Shown as "[RIVAL]" in opponent info
- Creates personal stakes - "the ones that got away"
- Rivals persist through save/load

NPC FOOD PREFERENCES:
- All NPCs get randomize_food_preferences() called at creation
- NPCs automatically get random preferences at contest entry (if somehow missing)
- Preference selection dialog only shown for player characters

FILES:
- scenes/game.gd - Draft pick integration, _show_draft_pick_dialog()
- scenes/ui/draft_pick_dialog.tscn - Draft selection UI scene
- src/ui/draft_pick_dialog.gd - Draft pick dialog logic
- src/ui/main_screen.gd - Skip preference dialog for NPCs
- src/ui/contest_setup_dialog.gd - Rival opponent selection at high ranks
- src/autoloads/game_manager.gd - contest_rivals storage, get_rival_as_opponent()

================================================================================
FATIGUE SYSTEM (Activity-Based)
================================================================================

Fatigue builds from completing activities, not from low mood. This creates
strategic trade-offs between pushing for income and managing streamer wellness.

FATIGUE GAIN (on activity completion):
| Activity   | Base Fatigue | Notes                              |
|------------|--------------|-------------------------------------|
| Streaming  | 15           | Main income, main fatigue source   |
| Contest    | 20           | High effort, high reward           |
| Socialize  | 8            | Light activity                     |
| Binge      | 5            | Eating is easy                     |
| Milking    | 10           | Moderate effort                    |
| Dr. Dan's  | 3            | Just shopping/procedures           |
| Relax      | 0            | Recovery activity (reduces fatigue)|

STAMINA MODIFIER:
- Higher stamina = less fatigue gained per activity
- Formula: actual_fatigue = base_fatigue * (1.0 - stamina/200)
- At stamina 0: 100% fatigue (base amount)
- At stamina 50: 75% fatigue
- At stamina 100: 50% fatigue
- Cybergoth passive: -20% energy drain also applies to fatigue

FATIGUE EFFECTS:
| Fatigue Level | Effect                                    |
|---------------|-------------------------------------------|
| 0-30          | None - normal operation                   |
| 31-60         | -10% effectiveness on all activities      |
| 61-80         | -25% effectiveness, mood decay +1/tick    |
| 81-99         | -50% effectiveness, mood decay +2/tick    |
| 100           | Exhausted - cannot work (only Relax)      |

FATIGUE RECOVERY:
- Relax station: -20 fatigue on completion (main recovery method)
- End of day: -10 fatigue (natural overnight recovery)
- High mood (70+) while idle: -1 fatigue per tick (slow passive)

DESIGN RATIONALE:
- Direct cause/effect: work hard ‚Üí get tired
- Strategic depth: pace your streamers vs push for quota
- Stamina stat matters: affects how long they can work
- Relax station has clear purpose: fatigue recovery
- No death spiral: fatigue doesn't cause more fatigue

================================================================================
TERMINOLOGY / GLOSSARY
================================================================================

PERFORMER
The player character when playing as any archetype except Licensee. Performers
can personally do content creation (streaming, contests, etc.) and are managed
directly by the player. When you "play as a performer," you ARE the content
creator, not just managing others.

LICENSEE
Special archetype where the player is a manager only. Cannot perform content
personally. Instead, drafts a rookie NPC at game start and manages NPCs. Gets
bonuses to NPC effectiveness and reduced salaries.

NPC (Non-Player Character)
Hired talent that performs content for the player. Generated through recruitment
or drafted (for Licensee). Have their own stats, preferences, and progression.
NPCs work for the player and take a salary cut.

STREAMER
Generic term for any character (performer or NPC) who creates content. Used
interchangeably with "talent" and "character" in context.

CHARACTER
Any data entity with stats (CharacterData). Includes the player's performer,
hired NPCs, contest opponents, and draft rookies.

ARCHETYPE
Character class that determines starting stats, passive abilities, and fat
distribution. Six archetypes: Glutton, Broodmother, E-Girl, Cybergoth, Hucow,
Licensee.

KINK
Content category a character is certified to perform. Purchased from Dr. Dan.
Examples: stuffing, pregnancy, lactation. Required for certain stream types.

STATION
Location where characters perform activities. Examples: Cam Studio (streaming),
Contest (eating competition), Relax (fatigue recovery), Dr. Dan's (augments).

QUOTA
Weekly earnings target set by CammTec. Must be met or player enters grace
period. Escalates 20% each week.

GRACE PERIOD
3-day window to pay shortfall + late fee after missing quota. Failure ends game.

CAPACITY
How much food a character can eat per session. Affects contest performance and
stuffing streams. Trainable stat.

FOLLOWER RANK
Character progression tier based on follower count. 23 ranks from "Nobody" (50)
to "Singularity" (1 billion). Determines contest tier access and space upgrades.

CONTEST RIVAL
NPCs rejected during Licensee draft pick. 60% chance to face them as opponents
at Pro/Elite contest ranks. Personal stakes.

HOLD V
Input method for confirmations where pressing E isn't available (e.g., name
entry where typing is active). Hold V key for ~0.35 seconds to confirm.
Shows progress bar animation.

================================================================================
TECHNICAL PITFALLS & PATTERNS
================================================================================

TYPED ARRAY JSON LOADING:
GDScript 4 typed arrays (Array[String], Array[Dictionary]) cannot be assigned
from JSON parsing, which returns untyped Arrays. Always use helper functions:
  var categories: Array[String] = GameManager.load_json_array_string(json_array)
  var items: Array[Dictionary] = GameManager.load_json_array_dict(json_array)

INPUT HANDLING:
- All dialogs should use _input() not _unhandled_input() for consistent behavior
- Always call get_viewport().set_input_as_handled() after processing input
- Use action names: "accept" (E), "back" (Q), "move_up/down/left/right" (WASD)

ASYNC UI TIMING:
When using await before updating UI, always check node validity:
  await get_tree().process_frame
  if not is_instance_valid(self) or not visible:
	  return
  _update_selection()

SIGNAL PARAMETER CHANGES:
When refactoring signals, search entire codebase for .connect() calls.
Godot doesn't validate signal signatures at parse time - mismatches crash at runtime.

SAVE DATA SYNC:
to_dict() and from_dict() on CharacterData must stay in sync. When adding new
fields, update BOTH methods. Consider a version field for migration.

PAUSE STATE (Stack-Based):
Use GameManager.push_pause("dialog_name") when opening a dialog.
Use GameManager.pop_pause("dialog_name") when closing.
Game only unpauses when stack is empty (supports nested dialogs).
Use GameManager.clear_pause_stack() for scene transitions (main menu, new game).
Example:
  func open_dialog():
	  show()
	  GameManager.push_pause("my_dialog")
  func close_dialog():
	  hide()
	  GameManager.pop_pause("my_dialog")

================================================================================
